#:import dp kivy.metrics.dp
#:import Factory kivy.factory.Factory
#:import FoodItem app.screens.components.food_item.FoodItem
#:import OrderItem app.screens.components.order_item.OrderItem

<FoodItem@MDBoxLayout>:
    orientation: 'vertical'
    size_hint_x: 0.5
    size_hint_y: 1
    height: dp(220)
    padding: dp(10)
    spacing: dp(8)
    food_id: ''
    food_name: ''
    price: 0
    image_source: ''
    price_text: ''
    available: 0
    canvas.before:
        Color:
            rgba: 0.95, 0.95, 1, 1
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [dp(25),]
    BoxLayout:
        size_hint_y: None
        height: dp(120)
        padding: dp(5)
        AnchorLayout:
            Image:
                source: root.image_source
                allow_stretch: True
                keep_ratio: True
                size_hint: None, None
                size: dp(120), dp(120)
    MDLabel:
        text: root.food_name
        font_size: '16sp'
        color: 0, 0, 0, 1
        halign: 'center'
        valign: 'bottom'
        text_size: self.size
        bold: True
    BoxLayout:
        orientation: 'horizontal'
        size_hint_y: None
        height: dp(24)
        spacing: dp(10)
        MDBoxLayout:
            orientation: 'vertical'
            spacing: dp(2)
            size_hint_x: 0.6
            MDLabel:
                text: root.price_text
                font_size: '15sp'
                color: 0.1, 0.1, 0.1, 1
                halign: 'left'
                size_hint_y: None
                height: dp(18)
            MDLabel:
                text: "Còn: " + str(root.available)
                font_size: '13sp'
                color: 0.4, 0.4, 0.4, 1
                halign: 'left'
                size_hint_y: None
                height: dp(16)
        MDRaisedButton:
            text: "THÊM"
            font_size: '13sp'
            bold: True
            md_bg_color: 0.0, 0.7, 0.3, 1 if root.available > 0 else (0.6, 0.6, 0.6, 1)
            text_color: 1, 1, 1, 1
            size_hint: None, None
            size: dp(70), dp(36)
            pos_hint: {'center_y': 0.5}
            on_press: root.add_to_order() if root.available > 0 else None
            disabled: root.available_ui <= 0

<OrderItem>:
    size_hint_y: None
    height: dp(48)
    padding: dp(3)
    spacing: dp(3)
    canvas.before:
        Color:
            rgba: 0.95, 0.95, 0.95, 1
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [dp(12),]
    MDLabel:
        text: root.food_name
        font_size: '16sp'
        size_hint_x: 0.4
        color: 0, 0, 0, 1
        halign: "left"
        valign: "middle"
        text_size: self.size
    MDIconButton:
        icon: "minus"
        md_bg_color: 0, 1, 0, 1
        text_color: 0, 0, 0, 1
        size_hint: None, None
        size: dp(28), dp(28)
        pos_hint: {"center_y": 0.5}
        on_press: root.decrease()
    MDLabel:
        text: str(root.quantity)
        font_size: "18sp"
        size_hint_x: None
        width: dp(20)
        halign: "center"
        valign: "middle"
        text_size: self.size
        color: 0, 0, 0, 1
    MDIconButton:
        icon: "plus"
        md_bg_color: 0, 1, 0, 1
        text_color: 0, 0, 0, 1
        size_hint: None, None
        size: dp(28), dp(28)
        pos_hint: {"center_y": 0.5}
        on_press: root.increase()

<DoAnScreen@Screen>:
    name: 'do_an'
    AnchorLayout:
        anchor_x: 'center'
        anchor_y: 'top'
        padding: dp(10)

        RecycleView:
            id: do_an_rv
            viewclass: 'FoodItem'
            scroll_type: ['bars', 'content']
            bar_width: dp(4)
            RecycleGridLayout:
                cols: 2
                default_size_hint: 0.5, None
                default_size: None, dp(200)
                size_hint_y: None
                height: self.minimum_height
                spacing: dp(10)


<ThucUongScreen@Screen>:
    name: 'thuc_uong'
    AnchorLayout:
        anchor_x: 'center'
        anchor_y: 'top'
        padding: dp(10)

        RecycleView:
            id: thuc_uong_rv
            viewclass: 'FoodItem'
            scroll_type: ['bars', 'content']
            bar_width: dp(4)
            RecycleGridLayout:
                cols: 2
                default_size_hint: 0.5, None
                default_size: None, dp(200)
                size_hint_y: None
                height: self.minimum_height
                spacing: dp(10)

<MainScreen@MDScreen>:
    name: "main"
    BoxLayout:
        orientation: 'horizontal'
        size: 1024, 600

        # Left Panel
        BoxLayout:
            orientation: 'vertical'
            padding: dp(15)
            spacing: dp(5)
            size_hint_x: 0.35
            canvas.before:
                Color:
                    rgba: 0.94, 0.94, 0.94, 1  # Xám nhạt
                Rectangle:
                    pos: self.pos
                    size: self.size
            MDLabel:
                id: logo
                text: "UIT"
                font_size: "48sp"
                halign: "center"
                color: 0.1, 0.1, 1, 1
                bold: True
                size_hint_y: None
                height: self.texture_size[1] + dp(20)
                on_touch_down: 
                    if self.collide_point(*args[1].pos): \
                    app.start_hold_timer()
                on_touch_up: 
                    if self.collide_point(*args[1].pos): \
                    app.check_hold_duration()
            MDLabel:
                text: "ĐƠN HÀNG"
                font_size: "24sp"
                halign: "center"
                color: 0, 0, 0, 1
                bold: True
                size_hint_y: None
            ScrollView:
                size_hint_y: 1
                BoxLayout:
                    id: order_box
                    orientation: 'vertical'
                    size_hint_y: None
                    height: self.minimum_height
                    spacing: dp(3)
                    padding: [dp(3)] * 4
            BoxLayout:
                size_hint_y: None
                height: dp(40)
                MDLabel:
                    text: "TỔNG:"
                    font_size: '20sp'
                    bold: True
                    size_hint_x: 0.4
                    color: 0, 0, 0, 1
                MDLabel:
                    id: total_label
                    text: "0 VND"
                    font_size: '20sp'
                    color: 0.2, 0.2, 0.2, 1
            AnchorLayout:
                size_hint_y: None
                height: dp(60)
                MDRoundFlatButton:
                    text: "THANH TOÁN"
                    md_bg_color: 1, 0.2, 0.2, 1
                    text_color: 0, 0, 0, 1
                    font_size: '22sp'
                    size_hint: None, None
                    size: dp(200), dp(60)
                    pos_hint: {"center_x": 0.5}
                    on_press: app.process_checkout()

        # Right Panel
        BoxLayout:
            orientation: 'vertical'
            padding: dp(10)
            spacing: dp(10)
            size_hint_x: 0.65

            AnchorLayout:
                size_hint_y: None
                height: dp(80)
                BoxLayout:
                    spacing: dp(20)
                    size_hint: None, None
                    width: dp(360)
                    height: dp(60)
                    MDRoundFlatButton:
                        text: "Đồ ăn"
                        font_size: '20sp'
                        size_hint: 1, 1
                        on_press: app.change_tab('do_an')
                    MDRoundFlatButton:
                        text: "Thức uống"
                        font_size: '20sp'
                        size_hint: 1, 1
                        on_press: app.change_tab('thuc_uong')
            ScreenManager:
                id: screen_manager
                DoAnScreen:
                ThucUongScreen:

            BoxLayout:
                size_hint_y: None
                height: dp(50)
                spacing: dp(10)
                padding: dp(10)
                MDIconButton:
                    icon: "chevron-left"
                    on_release: app.prev_page()
                MDLabel:
                    text: f"{app.current_page + 1}"
                    halign: "center"
                    theme_text_color: "Primary"
                MDIconButton:
                    icon: "chevron-right"
                    on_release: app.next_page()